@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    div.panel-body {
        overflow: scroll;
        background: url('http://subtlepatterns.com/patterns/geometry2.png');
    }
</style>
@if (ViewBag.Logged != null)
{
    <div class="jumbotron" style="margin-top:6rem">
        <h1>ADMINISTRADOR DE CANALES</h1>
        <p class="lead">En este proyecto se muestra como el administraddor puede comunicarse a traves de varios canales.</p>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h2>ENVÍO DE CORREOS</h2>
            <p>
                Aquí podrás enviar correos a los usuarios, y notificarles con el asunto que sea requerido.
            </p>
            <p><a class="btn btn-default" href="/Management/About">Ir a canal de correos</a></p>
        </div>
        <div class="col-md-6">
            <h2>CHAT DE MENSAJERÍA</h2>
            <p>Aquí podrás responder los mensajes de los usuarios han escrito en la aplicación.</p>
            <p><a class="btn btn-default" href="/Management/Chat">Ir a canal de mensajería</a></p>
        </div>
        <div class="col-md-6">
            <h2>Facebook</h2>
            <p>
                Aquí podrás enviar mensajes al perfil de Facebook del usuario.
            </p>
            <p><a class="btn btn-default" href="/Management/Facebook">Ir a canal de Facebook</a></p>
        </div>
        <div class="col-md-6">
            <h2>Twitter</h2>
            <p>
                Aquí podrás enviar notificaciones como un twit al usuario.
            </p>
            <p><a class="btn btn-default" href="/Management/Twitter">Ir a canal de Twitter</a></p>
        </div>
    </div>
    @section scripts {
        <script>
            document.getElementById("secundario-id").style.display = "block";
            document.getElementById("principal-id").style.display = "block";
        </script>
    }
}
else
{
    <br />
    <h2>Servicio al Cliente</h2>
    <div class="chat-panel panel panel-default">
        <div class="panel-heading">
            Bienvenido, escriba un mensaje para hacer atendido
            <i class="fa fa-paper-plane fa-fw"></i>
        </div>
        <!-- /.panel-heading -->
        <div class="panel-body" id="chat" style="height:450px;">
            <input type="hidden" id="displayname" />

            <p id="discussion"></p>
        </div>
        <!-- /.panel-body -->
        <div class="panel-footer">
            <div class="input-group">
                <input id="message" type="text" name="message" class="form-control input-sm" placeholder="Escriba su mensaje aquí..." />

                <span class="input-group-btn">
                    <input type="button" class="btn btn-warning btn-sm" id="sendmessage" value="Enviar">

                </span>
            </div>
        </div>
    </div>
    @section scripts {

        <!--Script references. -->
        <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
        <!--Reference the SignalR library. -->
        <script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="~/signalr/hubs"></script>
        <!--SignalR script to update the chat page and send messages.-->
        <script>
            document.getElementById("secundario-id").style.display = "none";
            document.getElementById("principal-id").style.display = "none";
            $( document ).ready(function() {
                $(function () {

                // Reference the auto-generated proxy for the hub.
                var chat = $.connection.chatHub;
                // Create a function that the hub can call back to display messages.
                chat.client.addNewMessageToPage = function (name, message) {
                    if (name == "Atir") {
                        // Add the message to the page.
                        $('#discussion').append('<p style="color:green; text-align:left; width:500px"><strong><img = src="https://www.phplivesupport.com/pics/icons/avatars/public/avatar_7.png" title="Atir">'
                            + ' </strong> ' + htmlEncode(message) + '</p>');
                    }
                    else if (name != "Atir") {
                        // Add the message to the page.
                        $('#discussion').append('<p style="color:blue;text-align:right;"><strong><img = src="https://www.phplivesupport.com/pics/icons/avatars/public/avatar_71.png" title="Peter">'
                            + ' </strong> ' + htmlEncode(message) + '</p>');
                    }
                };
                // Get the user name and store it to prepend to messages.
                $('#displayname').val(prompt('Ingrese su nombre:', ''));
                // Set initial focus to message input box.
                $('#message').focus();
                // Start the connection.
                $.connection.hub.start().done(function () {
                    $('#sendmessage').click(function () {
                        // Call the Send method on the hub.
                        chat.server.send($('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment.
                        $('#message').val('').focus();
                    });
                });
            });
            // This optional function html-encodes messages for display in the page.
            function htmlEncode(value) {
                var encodedValue = $('<div />').text(value).html();
                return encodedValue;
            }
            });
           
        </script>
    }

}
